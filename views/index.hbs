<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />


  <title>Document</title>
</head>

<body>
  <h1>My Position</h1>
  <p>
    latitude: <span id="latitude"></span>&deg;<br />
    longitude: <span id="longitude"></span>&deg;
  </p>


  <h2 class="my-3">Register an account</h2>

  <div class="card col-lg-4 col-md-8 my-3 form">
    <form id="form" action="/auth/signup" method="POST">
      <br>
      <label for="username">Name</label>
      <input class=" w-100" type="text" name="username" placeholder="e.g. John Doe" required pattern="\w+"
        title="Please input a valid username" onchange="
        this.setCustomValidity(this.validity.patternMismatch ? this.title : '');">
      <br>
      <label for="username">Email</label>
      <input class=" w-100" type="email" name="username" placeholder="john@doe.com" required
        title="Please input a valid email address">
      <br>
      <label class="mt-3" for="password">Password</label>
      <input class=" w-100" type="password" name="password" placeholder="*******" required
        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}"
        title="Passwords must be at least six characters long, and include both lower and uppercase letters and at least one number."
        onchange="
        this.setCustomValidity(this.validity.patternMismatch ? this.title : '');
  if(this.checkValidity()) form.password2.pattern = RegExp.escape(this.value);">
      <br>
      <label class="mt-3" for="passwordRepeat">Repeat your password</label>
      <input class=" w-100" type="password" name="passwordRepeat" placeholder="*******" required
        pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}" title="Please, ensure both passwords are the same" onchange="
        this.setCustomValidity(this.validity.patternMismatch ? this.title : '');">
      <br>

      <br>
      <div class="mb-3 align-items-center">
        <p class="">Please select the location of your balcony on the map to autofill your coordinates</p>
        <div class="row justify-content-center">

          <div class="col-lg-4">
            <label class="d-inline" for="latitude">Latitude:</label>
            <input id="lat" class="d-inline" type="string" name="latitude" placeholder="Latitude" required>
          </div>
          <div class="col-lg-4">
            <label class="d-inline" for="longitude">Longitude:</label>
            <input id="lon" class="d-inline" type="string" name="longitude" placeholder="Longitude" required>
          </div>
        </div>
      </div>


      <button type="submit" class="btn my-4 btn-primary w-100">Create an account</button>
  </div>
  </form>

  {{#if errorMessage}}
  <h4 class="rounded-pill text-center py-3 px-2 bg-danger text-light font-weight-bold mb-5">{{ errorMessage}}</h4>
  {{/if}}
  </div>

  <div id="mymap"></div>

  {{!-------------------------------------------MAPA-------------------------------------------}}
    <script>
    const latInput = document.getElementById("lat")
    const lonInput = document.getElementById("lon")
    const mymap = L.map("mymap", {
        marker = L.marker([lat, lon]).addTo(mymap);
      minZoom: 14,
    })
    let marker
    if ("geolocation" in navigator) {
      console.log("geolocation available");
      navigator.geolocation.getCurrentPosition(position => {
        lat = position.coords.latitude;
        lon = position.coords.longitude;
        console.log(lat, lon);
        document.getElementById("latitude").textContent = lat;
        document.getElementById("longitude").textContent = lon;
        mymap.setView([lat, lon], 20);
        const attribution ='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> ';
        const tileUrl = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
        const tiles = L.tileLayer(tileUrl, { attribution });
        tiles.addTo(mymap);
        marker = L.marker([lat, lon]).addTo(mymap);
        latInput.value = lat
        lonInput.value = lon
      })
    } else {
      console.log("geolocation not available")
    }

  </script>
{{!-------------------------------------------MAPA-------------------------------------------}}

</body>

</html>